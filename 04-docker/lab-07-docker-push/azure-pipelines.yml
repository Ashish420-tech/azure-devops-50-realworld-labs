# Lab-07: Build and Push Docker Image to Docker Hub

trigger:
  paths:
    include:
      - 04-docker/lab-07-docker-push/*

pr: none

pool:
  name: Default   # self-hosted Windows agent

variables:
  dockerRegistryServiceConnection: dockerhub-service-connection
  imageRepository: ashish420tech/nodejs-lab07
  dockerfilePath: 04-docker/lab-07-docker-push/Dockerfile
  buildContext: 04-docker/lab-07-docker-push
  tag: $(Build.BuildId)

steps:
- checkout: self

- task: Docker@2
  displayName: Build and Push Docker Image
  inputs:
    command: buildAndPush
    containerRegistry: $(dockerRegistryServiceConnection)
    repository: $(imageRepository)
    dockerfile: $(dockerfilePath)
    buildContext: $(buildContext)
    tags: |
      $(tag)
      latest

