trigger:
  branches:
    include:
      - main

pool:
  name: Default   # your self-hosted agent pool

stages:
- stage: Build
  displayName: Build Stage
  jobs:
  - job: DockerBuild
    displayName: Build Docker Image
    steps:

    # Checkout source
    - checkout: self
      clean: true

    # (Optional) Show repo structure for debugging
    - script: |
        echo "Listing repo root"
        dir
      displayName: Debug - Repo Structure

    # Build Docker image with NO CACHE (CRITICAL FIX)
    - task: Docker@2
      displayName: Build Docker image (no cache)
      inputs:
        command: build
        Dockerfile: 04-docker/lab-05-docker-ci/Dockerfile
        buildContext: .
        arguments: --no-cache
        tags: |
          $(Build.BuildId)
