trigger:
- main

pool:
  name: Default   # your self-hosted Windows agent

variables:
  imageName: nodejs-ci-lab

steps:
# 1️⃣ Checkout source
- checkout: self
  clean: true

# 2️⃣ Verify Docker is running
- task: CmdLine@2
  displayName: "Verify Docker"
  inputs:
    script: |
      docker version
      docker info

# 3️⃣ Build Docker image (NO CACHE)
- task: Docker@2
  displayName: "Build Docker image"
  inputs:
    command: build
    dockerfile: 04-docker/lab-05-docker-ci/Dockerfile
    buildContext: .
    tags: |
      $(Build.BuildId)
    arguments: --no-cache
