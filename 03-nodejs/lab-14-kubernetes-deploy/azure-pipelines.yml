
trigger:
- main

pool:
  name: Default   # self-hosted agent on same machine as Minikube

steps:
- checkout: self

- script: |
    echo "Kubernetes context:"
    kubectl config current-context
    kubectl get nodes
  displayName: "Verify Minikube Access"

- script: |
    cd 03-nodejs/lab-14-kubernetes-deploy/app
    docker build -t lab14-nodejs:latest .
  displayName: "Build Docker Image"

- script: |
    kubectl apply -f 03-nodejs/lab-14-kubernetes-deploy/k8s/deployment.yml
    kubectl apply -f 03-nodejs/lab-14-kubernetes-deploy/k8s/service.yml
  displayName: "Deploy to Local Minikube"
